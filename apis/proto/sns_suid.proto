// @file sns_suid.proto
//
// @brief Defines standard message types to request and receive SUIDs.
//
// @copyright
// Copyright (c) 2023-2025 Qualcomm Innovation Center, Inc. All rights reserved.
// SPDX-License-Identifier: BSD-3-Clause-Clear
//
// @details This file provides definitions for requests and parameters for
// requesting SUID of a given data type. It also provides the
// definition of the suid response event.

// ## Attribute Requirements:
// 1. SNS_STD_SENSOR_ATTRID_TYPE: "suid"
// 2. SNS_STD_SENSOR_ATTRID_STREAM_TYPE: SNS_STD_SENSOR_STREAM_TYPE_SINGLE_OUTPUT
// 3. SNS_STD_SENSOR_ATTRID_API: "sns_suid.proto"
//
// ## Processing Stream Requests:
// - SNS_SUID_MSGID_SNS_SUID_REQ is used to request for SUIDs that support the specified Data Type.
//   Searches all registered sensors for matching data_type attribute
//   * Supports one-shot (register_updates=false) or continuous (register_updates=true) requests
//   * Can return default sensor only (default_only=true) or all matches (default_only=false)
//   * Responds with SNS_SUID_MSGID_SNS_SUID_EVENT containing matching SUIDs
//   * Sends SNS_SUID_MSGID_SNS_SUID_DISCOVERY_DONE_EVENT when discovery completes
//   * One-shot requests are automatically cleaned up after discovery completes
//   * Continuous requests remain active until client disconnects
//
// ## Publishing Stream Events:
// - SNS_SUID_MSGID_SNS_SUID_EVENT is used to send the event containing SUIDs that support the requested Data Type.
//   Sent in response to SNS_SUID_REQ, contains SUIDs matching the requested data type.
//   May be sent multiple times as sensors become available
//
// - SNS_SUID_MSGID_SNS_SUID_DISCOVERY_DONE_EVENT is used to send the event containing the suid discovery complete notification.
//   Sent to notify clients that sensor discovery is complete.
//   After receiving this event:
//   * All sensors that will be available have been discovered
//   * Clients can safely proceed with sensor initialization
//   This event is sent only once, either:
//   - After physical sensors complete initialization, OR
//   - After SUID sensor starts (timeout fallback), OR
//   - Immediately to clients connecting after discovery is complete
//   The event timestamp in this event indicates when suid discovery actually completed

syntax = "proto2";
import "nanopb.proto";
import "sns_std_type.proto";


// @brief the Message ID for SUID request
enum sns_suid_msgid {
  option (nanopb_enumopt).long_names = false;

  // @brief Request for SUIDs that support the specified Data Type.
  // Message: sns_suid_req
  SNS_SUID_MSGID_SNS_SUID_REQ = 512;

  // @brief Event containing SUIDs that support the requested Data Type.
  // Message: sns_suid_event
  SNS_SUID_MSGID_SNS_SUID_EVENT = 768;

  // @brief Event containing the suid discovery complete notification.
  // Message: sns_suid_discovery_done_event
  SNS_SUID_MSGID_SNS_SUID_DISCOVERY_DONE_EVENT = 769;
}

// @brief UID for the SUID Sensor
// All other Sensor UIDs must be discovered dynamically
message sns_suid_sensor {
  required fixed64 suid_low = 1 [default = 0xabababababababab];
  required fixed64 suid_high = 2 [default = 0xabababababababab];
}

// @brief Request message for the list of SUIDs that support the specified Data Type.
//
// @details Note: Additional requests arriving on the same connection, will not result
// in a replaced request, but instead the new request will be appended to any
// active registrations.
message sns_suid_req {
  // @brief Data type as defined by the SNS_STD_SENSOR_ATTRID_TYPE in the 
  // Sensor proto.
  required string data_type = 1;

  // @brief Register for updates to the list of SUIDs advertising data_type
  optional bool register_updates = 2;

  // @brief Weather to request for the default sensor only.
  //
  // @details If there are multiple Sensors supporting a data type, one of these may be 
  // designated as "default" through registry by defining other attributes such
  // as SNS_STD_SENSOR_ATTRID_RIGID_BODY for the Sensor.
  //
  // If default_only field is not populated OR a default definition for the 
  // data type is not present, the SUID of the first Sensor supporting the data
  // type will be sent when available.
  //
  // If default_only field is set to true, only the UID of the Sensor that
  // supports all the attribute requirements for "default" will be sent when
  // available.
  //
  // If default_only is set to false, UIDs of all Sensors supporting the data
  // type will be sent, as and when they become available.  
  optional bool default_only = 3 [default = true];
}

// @brief Event specifying the list of SUIDs supporting the given Data Type.
// Receipt of this event indicates that a change to this list has occurred
// since the previous event.
message sns_suid_event {
  // @brief Data type as defined by the SNS_STD_SENSOR_ATTRID_TYPE in the 
  // Sensor proto.
  required string data_type = 1;

  // @brief UIDs of the Sensors supporting the data type. 
  repeated sns_std_suid suid = 2;
}

// @brief Event specifying the suid discovery complete notification SNS_SUID_MSGID_SNS_SUID_DISCOVERY_DONE_EVENT.
// This event is to notify the external clients that all the sensors in the framework
// have either published available or de-initialized and not available, as a response to the client's SUID request
message sns_suid_discovery_done_event {

}
